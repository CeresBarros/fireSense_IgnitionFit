---
title: "fireSense_FrequencyFit"
author: "Jean Marchal"
date: "August 2016"
output:
  html_document: default
  pdf_document: default
---

# Overview
Fit statistical models that can be used to parameterize (calibrate) the fire ignition component of landscape fire models (e.g. fireSense).

# Download the module
```{r download module, eval = FALSE, echo = TRUE}
library(SpaDES)

moduleName <- "fireSense_FrequencyFit"

workingDirectory <- tempdir() # Change this to a place you would like to put the model, if desired

downloadModule(moduleName, path = workingDirectory)
```

# Usage
```{r module_usage, eval = FALSE}
library(SpaDES)
library(DEoptimR)
library(MASS)
library(magrittr)
library(numDeriv)

set.seed(1)

df <- data.frame(
  weather = rnorm(1000, 150, 30),
  fireFrequency = rpois(1000, .5)
)

#outputDir <- file.path(tempdir(), "outputs")
times <- list(start = 1, end = 1)
parameters <- list(
  fireSense_FrequencyFit = list(
    formula = formula(fireFrequency ~ weather),
    family = poisson,
    start = c(1, 1),
    data = "df" ## TODO: where the data lives
  )
)

modules <- list("fireSense_FrequencyFit")
objects <- "df"
paths <- list(
  # cachePath = file.path(outputDir, "cache"),
  modulePath = file.path("~/Documents/GitHub/McIntire-lab/modulesPrivate/") ## TODO: change this to tempdir()
  # inputPath = inputDir,
  # outputPath = outputDir
)
 
mySim <- simInit(times = times, params = parameters, modules = modules, objects = objects, paths = paths)

# If piecewise
 params(mySim)$fireSense_FrequencyFit$formula <- formula(fireFrequency ~ pw(weather, k))

spades(mySim)
```

# Events
Events are scheduled as follows:

- Module initiation
- Model fitting

## Saving
TODO: Write what is saved. (there is currently no save, but this may change in the future)

## Output data
An object of class "fireSense_FrequencyFit", i.e. a list containing the following components:

- formula
- family
- coef
- se.coef

and optionally:

- if the formula contains piecewise terms:
    - knots
    - se.knots

- if the family is negative.binomial:
    - theta
    - theta.se

# Links to other modules
This model can be used to calibrate the fire ignition component of landscape fire models such as fireSense.

